<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Битва с Зомби</title>
    <style>
        body {
            background-color: #333;
            color: white;
            font-family: Arial, sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            height: 100vh;
            margin: 0;
            overflow: hidden;
        }

        #game-container {
            position: relative;
            width: 800px;
            height: 600px;
            border: 2px solid white;
            background-color: #222;
            cursor: crosshair;
            overflow: hidden;
        }

        #player {
            width: 30px;
            height: 30px;
            background-color: limegreen;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 10;
        }

        .zombie {
            width: 25px;
            height: 25px;
            background-color: red;
            position: absolute;
        }

        .boss {
            width: 75px;
            height: 75px;
            background-color: darkred;
            position: absolute;
        }

        .bullet {
            width: 5px;
            height: 5px;
            background-color: yellow;
            border-radius: 50%;
            position: absolute;
        }

        #info-panel {
            width: 800px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
        }
        
        #shop {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.8);
            border: 2px solid white;
            padding: 20px;
            display: none;
            flex-direction: column;
            align-items: center;
            z-index: 100;
        }

        .shop-item {
            padding: 10px;
            margin: 5px;
            background-color: #555;
            cursor: pointer;
            border: 1px solid white;
            width: 250px;
            text-align: center;
        }

        #game-over-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(0, 0, 0, 0.9);
            width: 100%;
            height: 100%;
            display: none;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            z-index: 200;
            text-align: center;
        }
        #game-over-screen button {
            margin-top: 20px;
            padding: 10px 20px;
            font-size: 1.2em;
            cursor: pointer;
        }
    </style>
</head>
<body>

    <h1>Битва с Зомби</h1>

    <div id="info-panel">
        <div>
            Здоровье: <span id="health-value">100</span>
        </div>
        <div>
            Монеты: <span id="coins-value">0</span>
        </div>
        <div>
            Уровень: <span id="round-value">1</span>
        </div>
    </div>

    <div id="game-container">
        <div id="player"></div>
        <div id="shop">
            <h2>Магазин</h2>
            <div id="current-weapon">Текущее оружие: Старый пистолет</div>
            <div class="shop-item" data-weapon="shotgun">
                Дробовик (Урон: 20, Скорость: 500мс) - 100 монет
            </div>
            <div class="shop-item" data-weapon="machinegun">
                Автомат (Урон: 5, Скорость: 100мс) - 250 монет
            </div>
            <div class="shop-item" data-weapon="sniper">
                Снайперская винтовка (Урон: 100, Скорость: 1500мс) - 500 монет
            </div>
            <div class="shop-item" data-weapon="pistol">
                Старый пистолет (Урон: 10, Скорость: 300мс) - 0 монет
            </div>
            <button onclick="toggleShop()">Закрыть</button>
        </div>
        <div id="game-over-screen">
            <h2>Игра окончена!</h2>
            <p>Вы продержались до уровня <span id="final-round"></span></p>
            <p>Вы заработали <span id="final-coins"></span> монет</p>
            <button onclick="location.reload()">Начать заново</button>
        </div>
    </div>

    <script>
        const gameContainer = document.getElementById('game-container');
        const player = document.getElementById('player');
        const healthValue = document.getElementById('health-value');
        const coinsValue = document.getElementById('coins-value');
        const roundValue = document.getElementById('round-value');
        const shop = document.getElementById('shop');
        const currentWeaponDisplay = document.getElementById('current-weapon');
        const gameOverScreen = document.getElementById('game-over-screen');
        const finalRound = document.getElementById('final-round');
        const finalCoins = document.getElementById('final-coins');

        let playerX = 400;
        let playerY = 300;
        let health = 100;
        let coins = 0;
        let round = 1;
        let zombies = [];
        let bullets = [];
        let isGameOver = false;

        const playerSpeed = 5;
        let keys = {};

        const weapons = {
            pistol: { damage: 10, fireRate: 300, cost: 0 },
            shotgun: { damage: 20, fireRate: 500, cost: 100 },
            machinegun: { damage: 5, fireRate: 100, cost: 250 },
            sniper: { damage: 100, fireRate: 1500, cost: 500 }
        };
        let currentWeapon = weapons.pistol;
        let lastShotTime = 0;

        document.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            if (e.key === 'm') {
                toggleShop();
            }
        });

        document.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });

        gameContainer.addEventListener('mousemove', (e) => {
            const rect = gameContainer.getBoundingClientRect();
            const angle = Math.atan2(e.clientY - rect.top - playerY, e.clientX - rect.left - playerX);
            player.style.transform = `translate(-50%, -50%) rotate(${angle + Math.PI / 2}rad)`;
        });

        gameContainer.addEventListener('mousedown', (e) => {
            if (isGameOver || shop.style.display !== 'none') return;
            const now = Date.now();
            if (now - lastShotTime > currentWeapon.fireRate) {
                shoot(e);
                lastShotTime = now;
            }
        });

        function shoot(e) {
            const rect = gameContainer.getBoundingClientRect();
            const mouseX = e.clientX - rect.left;
            const mouseY = e.clientY - rect.top;

            const bullet = document.createElement('div');
            bullet.className = 'bullet';
            bullet.style.left = `${playerX}px`;
            bullet.style.top = `${playerY}px`;
            gameContainer.appendChild(bullet);

            const angle = Math.atan2(mouseY - playerY, mouseX - playerX);
            const speed = 10;
            bullet.velX = Math.cos(angle) * speed;
            bullet.velY = Math.sin(angle) * speed;
            bullet.damage = currentWeapon.damage;

            bullets.push(bullet);
        }

        function createZombie(isBoss = false) {
            const zombie = document.createElement('div');
            zombie.className = isBoss ? 'boss' : 'zombie';
            
            const side = Math.floor(Math.random() * 4);
            let x, y;
            if (side === 0) { // top
                x = Math.random() * 800;
                y = 0;
            } else if (side === 1) { // right
                x = 800;
                y = Math.random() * 600;
            } else if (side === 2) { // bottom
                x = Math.random() * 800;
                y = 600;
            } else { // left
                x = 0;
                y = Math.random() * 600;
            }

            zombie.style.left = `${x}px`;
            zombie.style.top = `${y}px`;
            
            zombie.health = isBoss ? 200 + (round * 50) : 10 + (round * 5);
            zombie.speed = isBoss ? 0.5 + (round * 0.1) : 1 + (round * 0.2);
            zombie.isBoss = isBoss;

            gameContainer.appendChild(zombie);
            zombies.push(zombie);
        }

        function update() {
            if (isGameOver || shop.style.display !== 'none') return;

            // Player movement
            if (keys['w'] && playerY > 0) playerY -= playerSpeed;
            if (keys['s'] && playerY < 600) playerY += playerSpeed;
            if (keys['a'] && playerX > 0) playerX -= playerSpeed;
            if (keys['d'] && playerX < 800) playerX += playerSpeed;

            player.style.left = `${playerX}px`;
            player.style.top = `${playerY}px`;

            // Update bullets
            bullets.forEach((bullet, index) => {
                bullet.style.left = `${parseFloat(bullet.style.left) + bullet.velX}px`;
                bullet.style.top = `${parseFloat(bullet.style.top) + bullet.velY}px`;

                // Check for collision with zombies
                zombies.forEach((zombie, zIndex) => {
                    const bRect = bullet.getBoundingClientRect();
                    const zRect = zombie.getBoundingClientRect();
                    if (bRect.left < zRect.right && bRect.right > zRect.left && bRect.top < zRect.bottom && bRect.bottom > zRect.top) {
                        zombie.health -= bullet.damage;
                        bullet.remove();
                        bullets.splice(index, 1);

                        if (zombie.health <= 0) {
                            zombie.remove();
                            zombies.splice(zIndex, 1);
                            coins += zombie.isBoss ? 100 : 10;
                            coinsValue.textContent = coins;
                        }
                    }
                });

                // Remove bullet if it's out of bounds
                if (parseFloat(bullet.style.left) < 0 || parseFloat(bullet.style.left) > 800 || parseFloat(bullet.style.top) < 0 || parseFloat(bullet.style.top) > 600) {
                    bullet.remove();
                    bullets.splice(index, 1);
                }
            });

            // Update zombies
            zombies.forEach((zombie) => {
                const zX = parseFloat(zombie.style.left);
                const zY = parseFloat(zombie.style.top);
                const angle = Math.atan2(playerY - zY, playerX - zX);

                zombie.style.left = `${zX + Math.cos(angle) * zombie.speed}px`;
                zombie.style.top = `${zY + Math.sin(angle) * zombie.speed}px`;

                // Check for collision with player
                const pRect = player.getBoundingClientRect();
                const zRect = zombie.getBoundingClientRect();
                if (pRect.left < zRect.right && pRect.right > zRect.left && pRect.top < zRect.bottom && pRect.bottom > zRect.top) {
                    health -= 1;
                    healthValue.textContent = health;
                    if (health <= 0) {
                        endGame();
                    }
                }
            });

            // Check if round is complete
            if (zombies.length === 0) {
                startNextRound();
            }

            requestAnimationFrame(update);
        }

        function startNextRound() {
            round++;
            roundValue.textContent = round;
            
            if (round % 5 === 0) {
                // Boss round
                createZombie(true);
            } else {
                // Regular round
                for (let i = 0; i < round * 2; i++) {
                    createZombie();
                }
            }
        }

        function toggleShop() {
            if (shop.style.display === 'block') {
                shop.style.display = 'none';
            } else {
                shop.style.display = 'block';
            }
        }

        document.querySelectorAll('.shop-item').forEach(item => {
            item.addEventListener('click', () => {
                const weaponType = item.dataset.weapon;
                const weapon = weapons[weaponType];
                if (coins >= weapon.cost) {
                    coins -= weapon.cost;
                    coinsValue.textContent = coins;
                    currentWeapon = weapon;
                    currentWeaponDisplay.textContent = `Текущее оружие: ${weaponType === 'pistol' ? 'Старый пистолет' : (weaponType === 'shotgun' ? 'Дробовик' : (weaponType === 'machinegun' ? 'Автомат' : 'Снайперская винтовка'))}`;
                } else {
                    alert('Недостаточно монет!');
                }
            });
        });

        function endGame() {
            isGameOver = true;
            gameOverScreen.style.display = 'flex';
            finalRound.textContent = round;
            finalCoins.textContent = coins;
        }

        startNextRound();
        update();
    </script>
</body>
</html>
