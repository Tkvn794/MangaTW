<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zombie Shooter ‚Äî –æ–¥–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞</title>
<style>
  html,body{height:100%;margin:0;background:#111;color:#eee;font-family:Segoe UI,Roboto,Arial}
  #gameWrap{display:flex;flex-direction:column;align-items:center;padding:10px}
  canvas{background:#0b0b0b;border:4px solid #222;box-shadow:0 6px 20px rgba(0,0,0,0.8);touch-action:none}
  #hud{width:820px;display:flex;justify-content:space-between;align-items:center;margin:8px 0}
  .stat{background:rgba(255,255,255,0.03);padding:8px 12px;border-radius:6px}
  #shopBtn{cursor:pointer;padding:8px 12px;border-radius:6px;background:#1f8cff;border:2px solid #145ea8}
  #shop{position:fixed;right:18px;top:18px;width:320px;background:#0e0e0e;border:2px solid #333;padding:12px;border-radius:8px;display:none;z-index:20}
  #shop h3{margin:0 0 8px 0}
  .weapon{display:flex;justify-content:space-between;align-items:center;padding:8px;border-radius:6px;margin-bottom:8px;background:rgba(255,255,255,0.02)}
  .btnBuy{background:#2ecc71;padding:6px 8px;border-radius:6px;border:0;color:#062b16;cursor:pointer}
  .btnEquip{background:#f1c40f;padding:6px 8px;border-radius:6px;border:0;color:#2c1f00;cursor:pointer}
  #gameOver{position:fixed;left:50%;top:50%;transform:translate(-50%,-50%);background:#0b0b0b;padding:18px;border:2px solid #333;border-radius:8px;display:none;z-index:30}
  button{font-family:inherit}
  #controls{font-size:13px;color:#cfcfcf;margin-top:6px}
  .hpBar{width:140px;height:12px;background:#333;border-radius:6px;overflow:hidden}
  .hpFill{height:100%;background:linear-gradient(90deg,#f44336,#ff9800)}
  .coin{font-weight:700;color:#ffd54f}
  small{color:#999}
</style>
</head>
<body>
<div id="gameWrap">
  <div id="hud" style="width:820px">
    <div class="stat">–ó–¥–æ—Ä–æ–≤—å–µ: <span id="hpText">100</span></div>
    <div class="stat">–ú–æ–Ω–µ—Ç—ã: <span id="coins" class="coin">0</span></div>
    <div class="stat">–í–æ–ª–Ω–∞: <span id="wave">1</span></div>
    <div><button id="shopBtn">SHOP</button></div>
  </div>

  <canvas id="game" width="820" height="520"></canvas>
  <div id="controls">
    –î–≤–∏–≥–∞–π—Å—è: <b>W A S D</b> –∏–ª–∏ —Å—Ç—Ä–µ–ª–∫–∏ ‚Ä¢ –°—Ç—Ä–µ–ª—è—Ç—å: <b>–õ–ö–ú</b> ‚Ä¢ –û—Ç–∫—Ä–æ–π –º–∞–≥–∞–∑–∏–Ω: –∫–Ω–æ–ø–∫–∞ <b>SHOP</b>
  </div>
</div>

<div id="shop" aria-hidden="true">
  <h3>–ú–∞–≥–∞–∑–∏–Ω –æ—Ä—É–∂–∏—è</h3>
  <div id="weaponsList"></div>
  <div style="display:flex;justify-content:space-between;align-items:center;margin-top:8px">
    <div><small>–ù–∞–∂–º–∏—Ç–µ &quot;–ö—É–ø–∏—Ç—å&quot; —á—Ç–æ–±—ã –ø—Ä–∏–æ–±—Ä–µ—Å—Ç–∏. &quot;–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å&quot; ‚Äî —Å–º–µ–Ω–∏—Ç—å –æ—Ä—É–∂–∏–µ.</small></div>
    <div><button id="closeShop" style="padding:6px 10px">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  </div>
</div>

<div id="gameOver">
  <h2 id="goTitle">–¢—ã –ø–æ–≥–∏–±...</h2>
  <div style="margin:8px 0">–ú–æ–Ω–µ—Ç—ã: <span id="finalCoins"></span></div>
  <button id="restart">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
</div>

<script>
/* ========== –ò–≥—Ä–∞: –ø—Ä–æ—Å—Ç–∞—è –∑–æ–º–±–∏-–∞—Ä–∫–∞–¥–∞ ========== */
/* ----- –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ----- */
const canvas = document.getElementById('game');
const ctx = canvas.getContext('2d');

const UI = {
  hpText: document.getElementById('hpText'),
  coins: document.getElementById('coins'),
  wave: document.getElementById('wave'),
  shopBtn: document.getElementById('shopBtn'),
  shop: document.getElementById('shop'),
  weaponsList: document.getElementById('weaponsList'),
  closeShop: document.getElementById('closeShop'),
  gameOver: document.getElementById('gameOver'),
  finalCoins: document.getElementById('finalCoins'),
  restart: document.getElementById('restart')
};

const WIDTH = canvas.width;
const HEIGHT = canvas.height;

/* ----- –ò–≥—Ä–æ–∫ ----- */
const player = {
  x: WIDTH/2, y: HEIGHT/2, r: 12,
  speed: 2.6,
  hp: 100,
  maxHp: 100,
  weapon: null
};

/* ----- –û—Ä—É–∂–∏–µ (–º–∞–≥–∞–∑–∏–Ω) ----- */
const weapons = [
  {
    id:'pistol', name:'–ü–∏—Å—Ç–æ–ª–µ—Ç', price:0,
    bullets:1, spread:0, dmg:18, speed:9, fireRate:300, desc:'–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π. –ë–µ—Å–ø–ª–∞—Ç–Ω–æ.'
  },
  {
    id:'shotgun', name:'–î—Ä–æ–±–æ–≤–∏–∫', price:120,
    bullets:6, spread:0.5, dmg:8, speed:7, fireRate:700, desc:'–ö–æ—Ä–æ—Ç–∫–∏–π –≤—ã—Å—Ç—Ä–µ–ª, –º–Ω–æ–≥–æ –¥—Ä–æ–±–∏.'
  },
  {
    id:'rifle', name:'–í–∏–Ω—Ç–æ–≤–∫–∞', price:350,
    bullets:1, spread:0, dmg:65, speed:12, fireRate:500, desc:'–°–∏–ª—å–Ω—ã–π —Ç–æ—á–Ω—ã–π –≤—ã—Å—Ç—Ä–µ–ª.'
  },
  {
    id:'uzi', name:'–ü—É–ª–µ–º–µ—Ç UZI', price:500,
    bullets:1, spread:0.1, dmg:9, speed:11, fireRate:100, desc:'–ë—ã—Å—Ç—Ä–∞—è –æ—á–µ—Ä–µ–¥—å.'
  },
  {
    id:'flame', name:'–û–≥–Ω–µ–º—ë—Ç', price:700,
    bullets:3, spread:0.6, dmg:6, speed:6, fireRate:120, desc:'–ë–ª–∏–∂–µ –∫ –≤—Ä–∞–≥–∞–º ‚Äî –ª—É—á—à–µ.'
  }
];

let owned = new Set(['pistol']);
player.weapon = weapons[0]; // default

/* ----- –í—Ä–∞–≥–∏ (–∑–æ–º–±–∏) ----- */
let enemies = [];
let bullets = [];
let coins = [];
let wave = 1;
let spawnTimer = 0;
let spawnInterval = 120; // frames
let killedThisWave = 0;
let totalWaveEnemies = 6;
let bossActive = false;

/* ----- –ò–≥—Ä–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ ----- */
let keys = {};
let mouse = {x:0,y:0,down:false};
let lastShot = 0;
let coinCount = 0;
let gameRunning = true;

/* ----- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ ----- */
window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
canvas.addEventListener('mousemove',e=>{
  const rect = canvas.getBoundingClientRect();
  mouse.x = (e.clientX - rect.left) * (canvas.width/rect.width);
  mouse.y = (e.clientY - rect.top) * (canvas.height/rect.height);
});
canvas.addEventListener('mousedown',e=>{
  mouse.down = true;
});
canvas.addEventListener('mouseup',e=>{
  mouse.down = false;
});
UI.shopBtn.addEventListener('click',()=>toggleShop(true));
UI.closeShop.addEventListener('click',()=>toggleShop(false));
UI.restart.addEventListener('click',resetGame);

/* ----- –ú–∞–≥–∞–∑–∏–Ω UI ----- */
function renderShop(){
  UI.weaponsList.innerHTML = '';
  weapons.forEach(w=>{
    const div = document.createElement('div');
    div.className = 'weapon';
    const ownedFlag = owned.has(w.id);
    div.innerHTML = `
      <div>
        <div style="font-weight:700">${w.name} ${ownedFlag?'<small style="color:#6fdc97">‚Ä¢ owned</small>':''}</div>
        <div style="font-size:12px;color:#bbb">${w.desc}</div>
      </div>
      <div style="text-align:right">
        <div style="margin-bottom:6px">${w.price>0? w.price+' üí∞' : '0 üí∞'}</div>
        ${ownedFlag? `<button class="btnEquip" data-id="${w.id}">–≠–∫–∏–ø–∏—Ä–æ–≤–∞—Ç—å</button>` :
                    `<button class="btnBuy" data-id="${w.id}">–ö—É–ø–∏—Ç—å</button>`}
      </div>`;
    UI.weaponsList.appendChild(div);
  });
  // attach events
  Array.from(UI.weaponsList.querySelectorAll('.btnBuy')).forEach(b=>{
    b.addEventListener('click',ev=>{
      const id = ev.currentTarget.dataset.id;
      const w = weapons.find(x=>x.id===id);
      if(coinCount >= w.price){
        coinCount -= w.price;
        owned.add(w.id);
        renderShop();
        updateUI();
      } else {
        alert('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–æ–Ω–µ—Ç!');
      }
    });
  });
  Array.from(UI.weaponsList.querySelectorAll('.btnEquip')).forEach(b=>{
    b.addEventListener('click',ev=>{
      const id = ev.currentTarget.dataset.id;
      const w = weapons.find(x=>x.id===id);
      player.weapon = w;
      toggleShop(false);
    });
  });
}

function toggleShop(show){
  UI.shop.style.display = show? 'block' : 'none';
  UI.shop.setAttribute('aria-hidden', !show);
  if(show) renderShop();
}

/* ----- –°–ø–∞—É–Ω –∑–æ–º–±–∏ ----- */
function spawnEnemy(isBoss=false){
  // spawn at border
  let edge = Math.floor(Math.random()*4);
  let x,y;
  if(edge===0){x = -20; y = Math.random()*HEIGHT;}
  if(edge===1){x = WIDTH+20; y = Math.random()*HEIGHT;}
  if(edge===2){x = Math.random()*WIDTH; y = -20;}
  if(edge===3){x = Math.random()*WIDTH; y = HEIGHT+20;}
  const baseHp = isBoss ? 350 + wave*60 : 20 + Math.floor(wave*4 + Math.random()*wave*3);
  const speed = isBoss ? 0.8 + wave*0.03 : 0.7 + Math.random()*0.6 + Math.min(1.8, wave*0.06);
  const r = isBoss ? 28 : 12 + Math.random()*6;
  enemies.push({
    x, y, r, hp:baseHp, maxHp:baseHp, speed, isBoss,
    color: isBoss ? '#8b0000' : '#9bbf68',
    reward: isBoss ? 100 + wave*40 : 8 + Math.floor(Math.random()*10)
  });
}

/* ----- –ò–≥—Ä–æ–≤–æ–π —Ü–∏–∫–ª ----- */
let lastTime = performance.now();
function loop(now){
  const dt = now - lastTime;
  lastTime = now;
  if(gameRunning){
    update(dt);
    draw();
    requestAnimationFrame(loop);
  }
}
requestAnimationFrame(loop);

/* ----- –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ ----- */
function update(dt){
  // player movement
  let mvx = 0, mvy = 0;
  if(keys['w'] || keys['arrowup']) mvy -= 1;
  if(keys['s'] || keys['arrowdown']) mvy += 1;
  if(keys['a'] || keys['arrowleft']) mvx -= 1;
  if(keys['d'] || keys['arrowright']) mvx += 1;
  const mag = Math.hypot(mvx,mvy) || 1;
  player.x += (mvx/mag)*player.speed;
  player.y += (mvy/mag)*player.speed;
  player.x = Math.max(6, Math.min(WIDTH-6, player.x));
  player.y = Math.max(6, Math.min(HEIGHT-6, player.y));

  // shooting
  if(mouse.down){
    const nowT = performance.now();
    if(nowT - lastShot >= player.weapon.fireRate){
      shoot();
      lastShot = nowT;
    }
  }

  // bullets move & collisions
  for(let i=bullets.length-1;i>=0;i--){
    const b=bullets[i];
    b.x += b.vx; b.y += b.vy;
    b.life--;
    // hit enemies
    for(let j=enemies.length-1;j>=0 && b.life>0;j--){
      const e=enemies[j];
      const dx=e.x-b.x, dy=e.y-b.y;
      if(Math.hypot(dx,dy) < e.r + 2){
        e.hp -= b.dmg;
        b.life = 0;
        if(e.hp <= 0){
          // kill
          const dropCount = Math.max(1, Math.round(e.reward/6));
          for(let k=0;k<dropCount;k++){
            coins.push({x:e.x + (Math.random()-0.5)*20, y:e.y + (Math.random()-0.5)*20, vx:(Math.random()-0.5)*1.2, vy:(Math.random()-0.7)*2, val: Math.max(1, Math.round(e.reward/dropCount))});
          }
          coinCount += e.reward;
          killedThisWave++;
          enemies.splice(j,1);
          // boss defeated
          if(e.isBoss){
            bossActive = false;
            wave++;
            prepareNextWave();
          }
        }
      }
    }
    // remove bullet if offscreen or dead
    if(b.life<=0 || b.x<-50 || b.x>WIDTH+50 || b.y<-50 || b.y>HEIGHT+50) bullets.splice(i,1);
  }

  // enemies move toward player
  for(let i=enemies.length-1;i>=0;i--){
    const e = enemies[i];
    const dx = player.x - e.x, dy = player.y - e.y;
    const d = Math.hypot(dx,dy) || 1;
    e.x += (dx/d) * e.speed;
    e.y += (dy/d) * e.speed;

    // touch player
    if(d < e.r + player.r - 2){
      // damage and knockback
      const dmg = e.isBoss ? 18 : 8;
      player.hp -= dmg * 0.9;
      // small push
      e.x -= (dx/d)*10;
      e.y -= (dy/d)*10;
      if(player.hp <= 0){ endGame(); return; }
    }
  }

  // coins physics & pickup
  for(let i=coins.length-1;i>=0;i--){
    const c = coins[i];
    c.vy += 0.12;
    c.x += c.vx; c.y += c.vy;
    // pickup when near player
    const d = Math.hypot(player.x-c.x, player.y-c.y);
    if(d < 22){
      coinCount += c.val;
      coins.splice(i,1);
      updateUI();
      continue;
    }
    // remove if out of bounds
    if(c.x < -50 || c.x > WIDTH+50 || c.y > HEIGHT+200) coins.splice(i,1);
  }

  // spawn enemies
  if(!bossActive){
    spawnTimer++;
    if(spawnTimer >= spawnInterval){
      spawnTimer = 0;
      if(enemies.length < totalWaveEnemies){
        // boss appears every 5 waves
        if(killedThisWave >= totalWaveEnemies && wave % 5 === 0){
          bossActive = true;
          spawnEnemy(true);
        } else {
          spawnEnemy(false);
        }
      }
    }
    // check wave cleared
    if(killedThisWave >= totalWaveEnemies && enemies.length === 0 && !bossActive){
      wave++;
      prepareNextWave();
    }
  }

  updateUI();
}

function prepareNextWave(){
  killedThisWave = 0;
  totalWaveEnemies = 5 + Math.floor(wave*1.6);
  spawnInterval = Math.max(30, 120 - wave*6);
  // small reward for wave start
  coinCount += 20 + Math.floor(wave*5);
}

/* ----- –û—Ç—Ä–∏—Å–æ–≤–∫–∞ ----- */
function draw(){
  ctx.clearRect(0,0,WIDTH,HEIGHT);

  // background grid
  ctx.fillStyle = '#070707';
  ctx.fillRect(0,0,WIDTH,HEIGHT);

  // coins
  for(const c of coins){
    ctx.beginPath();
    ctx.fillStyle = '#ffd54f';
    ctx.arc(c.x,c.y,6,0,Math.PI*2);
    ctx.fill();
    ctx.fillStyle = '#6b3c00';
    ctx.font = '10px sans-serif';
    ctx.fillText(c.val, c.x-6, c.y+3);
  }

  // enemies
  for(const e of enemies){
    // body
    ctx.beginPath();
    ctx.fillStyle = e.color;
    ctx.arc(e.x,e.y,e.r,0,Math.PI*2);
    ctx.fill();
    // eyes
    ctx.fillStyle = '#111';
    ctx.fillRect(e.x - e.r/2+2, e.y - e.r/4, e.r/3, e.r/4);
    ctx.fillRect(e.x + e.r/6, e.y - e.r/4, e.r/3, e.r/4);
    // hp bar
    const w = e.r*2;
    const hx = e.x - e.r, hy = e.y - e.r - 8;
    ctx.fillStyle = '#333';
    ctx.fillRect(hx,hy,w,5);
    ctx.fillStyle = '#d32f2f';
    ctx.fillRect(hx,hy,w*(e.hp/e.maxHp),5);
    if(e.isBoss){
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 1;
      ctx.strokeRect(hx,hy,w,5);
    }
  }

  // bullets
  for(const b of bullets){
    ctx.beginPath();
    ctx.fillStyle = b.color || '#fff';
    ctx.arc(b.x,b.y, b.size||3, 0, Math.PI*2);
    ctx.fill();
  }

  // player
  ctx.save();
  ctx.translate(player.x,player.y);
  // direction
  const ang = Math.atan2(mouse.y - player.y, mouse.x - player.x);
  ctx.rotate(ang);
  // body
  ctx.beginPath();
  ctx.fillStyle = '#66c2ff';
  ctx.arc(0,0,player.r,0,Math.PI*2);
  ctx.fill();
  // gun
  ctx.fillStyle = '#333';
  ctx.fillRect(10, -6, 22, 12);
  ctx.restore();

  // UI bars
  // health box
  ctx.fillStyle = 'rgba(0,0,0,0.6)';
  ctx.fillRect(10, HEIGHT-36, 260, 28);
  ctx.strokeStyle = '#222';
  ctx.strokeRect(10, HEIGHT-36, 260, 28);
  ctx.fillStyle = '#ff6f6f';
  const hpW = Math.max(0, (player.hp/player.maxHp))*230;
  ctx.fillRect(20, HEIGHT-30, hpW, 16);
  ctx.fillStyle = '#fff';
  ctx.font = '12px sans-serif';
  ctx.fillText('HP', 20, HEIGHT-40+12);
  ctx.fillStyle = '#fff';
  ctx.fillText('–û—Ä—É–∂–∏–µ: ' + player.weapon.name, 300, HEIGHT-20);
}

/* ----- –°—Ç—Ä–µ–ª—å–±–∞ ----- */
function shoot(){
  const w = player.weapon;
  const baseAngle = Math.atan2(mouse.y - player.y, mouse.x - player.x);
  for(let i=0;i<w.bullets;i++){
    // random spread
    const spread = (Math.random()-0.5) * w.spread;
    const ang = baseAngle + spread;
    const speed = w.speed + (Math.random()*0.6-0.3);
    bullets.push({
      x: player.x + Math.cos(ang)*18,
      y: player.y + Math.sin(ang)*18,
      vx: Math.cos(ang)*speed,
      vy: Math.sin(ang)*speed,
      dmg: w.dmg + (Math.random()*0.15-0.07)*w.dmg,
      life: 60,
      size: w.id==='flame'?4:3,
      color: w.id==='flame' ? '#ff8a33' : '#fff'
    });
  }
}

/* ----- UI –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ ----- */
function updateUI(){
  UI.hpText.textContent = Math.max(0, Math.round(player.hp));
  UI.coins.textContent = coinCount;
  UI.wave.textContent = wave;
}

/* ----- –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã ----- */
function endGame(){
  gameRunning = false;
  UI.finalCoins.textContent = coinCount;
  UI.gameOver.style.display = 'block';
  UI.gameOver.style.zIndex = 999;
  UI.goTitle.textContent = '–¢—ã –ø–æ–≥–∏–±...';
}

/* ----- –°–±—Ä–æ—Å ----- */
function resetGame(){
  // reset variables
  enemies = [];
  bullets = [];
  coins = [];
  coinCount = 0;
  wave = 1;
  spawnTimer = 0;
  spawnInterval = 120;
  killedThisWave = 0;
  totalWaveEnemies = 6;
  bossActive = false;
  player.x = WIDTH/2; player.y = HEIGHT/2; player.hp = player.maxHp;
  owned = new Set(['pistol']);
  player.weapon = weapons[0];
  UI.gameOver.style.display = 'none';
  gameRunning = true;
  lastShot = 0;
  requestAnimationFrame(loop);
}

/* ----- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è ----- */
updateUI();
renderShop();
prepareNextWave();

/* small mobile support: tap to shoot */
canvas.addEventListener('touchstart', e=>{
  e.preventDefault();
  const t = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  mouse.x = (t.clientX - rect.left) * (canvas.width/rect.width);
  mouse.y = (t.clientY - rect.top) * (canvas.height/rect.height);
  mouse.down = true;
});
canvas.addEventListener('touchmove', e=>{
  const t = e.touches[0];
  const rect = canvas.getBoundingClientRect();
  mouse.x = (t.clientX - rect.left) * (canvas.width/rect.width);
  mouse.y = (t.clientY - rect.top) * (canvas.height/rect.height);
});
canvas.addEventListener('touchend', e=>{
  mouse.down = false;
});
</script>
</body>
</html>
