<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç Firebase</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-database-compat.js"></script>
</head>
<body>
    <h2>–¢–µ—Å—Ç Firebase –Ω–∞ —Ç–µ–ª–µ—Ñ–æ–Ω–µ</h2>
    <div id="status">–ó–∞–≥—Ä—É–∑–∫–∞...</div>
    <br>
    <input type="text" id="test-message" placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" style="width: 70%;">
    <button onclick="sendMessage()" style="width: 25%;">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    <br><br>
    <h3>–°–æ–æ–±—â–µ–Ω–∏—è:</h3>
    <div id="messages" style="border:1px solid #ccc; padding:10px; min-height:200px; overflow-y: auto;"></div>

    <script>
        // –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyCfzfqOEXyO4f9w_WHfb5ba6VucR4C1h7Q",
            authDomain: "webrtc-chat-d4b03.firebaseapp.com",
            databaseURL: "https://webrtc-chat-d4b03-default-rtdb.firebaseio.com/",
            projectId: "webrtc-chat-d4b03",
            storageBucket: "webrtc-chat-d4b03.firebasestorage.app",
            messagingSenderId: "664462632968",
            appId: "1:664462632968:web:5908950ee288dde239c9bd"
        };

        let messagesRef;

        try {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
            firebase.initializeApp(firebaseConfig);
            document.getElementById('status').innerHTML = '‚úÖ Firebase –ø–æ–¥–∫–ª—é—á–µ–Ω<br>';
            
            // –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–º–Ω–∞—Ç–µ
            const db = firebase.database();
            messagesRef = db.ref('mobile_test_room');
            
            document.getElementById('status').innerHTML += '‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω—ã –∫ –∫–æ–º–Ω–∞—Ç–µ<br>';
            
            // –°–ª—É—à–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏—è
            messagesRef.on('child_added', (snapshot) => {
                const data = snapshot.val();
                const msgDiv = document.createElement('div');
                msgDiv.innerHTML = `<strong>${data.text}</strong> <small>(${new Date(data.timestamp).toLocaleTimeString()})</small>`;
                document.getElementById('messages').appendChild(msgDiv);
                document.getElementById('messages').scrollTop = document.getElementById('messages').scrollHeight;
                document.getElementById('status').innerHTML += 'üì• –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ<br>';
            });
            
            document.getElementById('status').innerHTML += '‚úÖ –ì–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ<br>';
            
        } catch (error) {
            document.getElementById('status').innerHTML += '‚ùå –û—à–∏–±–∫–∞: ' + error.message;
            console.error('–û—à–∏–±–∫–∞:', error);
        }
        
        function sendMessage() {
            try {
                const message = document.getElementById('test-message').value;
                if (!message.trim()) return;
                
                messagesRef.push({
                    text: message,
                    timestamp: Date.now()
                });
                
                document.getElementById('test-message').value = '';
                document.getElementById('status').innerHTML += 'üì§ –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ<br>';
                
            } catch (error) {
                document.getElementById('status').innerHTML += '‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏: ' + error.message;
                console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏:', error);
            }
        }
    </script>
</body>
</html>
